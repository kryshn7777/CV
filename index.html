<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Krishnaprasath: Mechatronic Quest (Fluid)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700&family=Share+Tech+Mono&display=swap');

        body {
            margin: 0;
            overflow: hidden;
            background-color: #0b1120; /* Darker slate */
            color: #38bdf8;
            font-family: 'Share Tech Mono', monospace;
            user-select: none;
            touch-action: none;
        }

        #game-layer {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }

        /* UI Overlay */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        .hud-panel {
            position: absolute;
            background: rgba(15, 23, 42, 0.9);
            border: 1px solid #38bdf8;
            padding: 15px;
            pointer-events: auto;
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.3);
            border-radius: 8px;
            backdrop-filter: blur(4px);
            transition: all 0.3s ease;
        }

        .hud-top-left { top: 20px; left: 20px; }
        .hud-top-right { top: 20px; right: 20px; text-align: right; }
        
        .health-bar-bg {
            width: 200px; height: 12px; background: #334155;
            border-radius: 6px; overflow: hidden; margin-top: 5px;
        }
        .health-bar-fill {
            height: 100%; background: linear-gradient(90deg, #ef4444, #f87171);
            width: 100%; transition: width 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Dash Indicator */
        .dash-bar-bg {
            width: 200px; height: 6px; background: #334155;
            border-radius: 3px; overflow: hidden; margin-top: 5px;
        }
        .dash-bar-fill {
            height: 100%; background: #fbbf24; width: 100%;
        }

        /* Start Screen */
        #start-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #1e293b 0%, #020617 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 50; pointer-events: auto;
        }
        
        .title {
            font-family: 'Exo 2', sans-serif; font-size: 4rem; font-weight: 800;
            background: linear-gradient(to right, #38bdf8, #818cf8);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(56, 189, 248, 0.5);
            text-align: center; line-height: 1.1; margin-bottom: 1rem;
        }

        .btn {
            background: #38bdf8; color: #0f172a; border: none;
            padding: 15px 40px; font-family: 'Exo 2'; font-weight: bold; font-size: 1.2rem;
            cursor: pointer; border-radius: 50px;
            box-shadow: 0 0 20px rgba(56, 189, 248, 0.4);
            transition: transform 0.1s, box-shadow 0.1s;
        }
        .btn:hover { transform: scale(1.05); box-shadow: 0 0 30px rgba(56, 189, 248, 0.6); }
        .btn:active { transform: scale(0.95); }

        /* Modal */
        #modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex; justify-content: center; align-items: center;
            z-index: 100; opacity: 0; pointer-events: none; transition: opacity 0.3s;
            backdrop-filter: blur(5px);
        }
        #modal-overlay.active { opacity: 1; pointer-events: auto; }

        .info-card {
            background: #1e293b; border: 1px solid #38bdf8;
            width: 90%; max-width: 500px; max-height: 80vh; overflow-y: auto;
            padding: 30px; border-radius: 12px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            transform: translateY(20px); transition: transform 0.3s;
        }
        #modal-overlay.active .info-card { transform: translateY(0); }

        .info-card h2 { color: #fff; font-family: 'Exo 2'; margin-top: 0; border-bottom: 2px solid #334155; padding-bottom: 15px; }
        .info-card .content { color: #cbd5e1; line-height: 1.6; }
        .skill-tag { display: inline-block; background: #0f172a; color: #38bdf8; padding: 4px 10px; border-radius: 20px; margin: 3px; font-size: 0.85em; border: 1px solid #334155; }

        /* Mobile Controls */
        #mobile-controls { display: none; position: absolute; bottom: 20px; left: 20px; pointer-events: auto; }
        #mobile-actions { display: none; position: absolute; bottom: 20px; right: 20px; gap: 15px; pointer-events: auto; }

        .joystick-area { width: 120px; height: 120px; background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 255, 255, 0.1); border-radius: 50%; position: relative; }
        .joystick-knob { width: 50px; height: 50px; background: rgba(56, 189, 248, 0.5); border-radius: 50%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); box-shadow: 0 0 10px #38bdf8; pointer-events: none; }

        .action-btn {
            width: 70px; height: 70px; border-radius: 50%; border: none;
            color: white; font-weight: bold; font-family: 'Exo 2';
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); touch-action: none;
        }
        #btn-shoot { background: rgba(239, 68, 68, 0.8); border: 2px solid #ef4444; }
        #btn-dash { background: rgba(251, 191, 36, 0.8); border: 2px solid #fbbf24; }
        .action-btn:active { transform: scale(0.9); filter: brightness(1.2); }

        @media (max-width: 768px) {
            .title { font-size: 2.5rem; }
            #mobile-controls, #mobile-actions { display: flex; }
        }
    </style>
</head>
<body>

    <canvas id="game-layer"></canvas>

    <!-- Start Screen -->
    <div id="start-screen">
        <h1 class="title">MECHATRONIC<br>QUEST</h1>
        <p style="color: #94a3b8; font-size: 1.1rem; max-width: 600px; text-align: center; margin-bottom: 2rem;">
            Explore the digital portfolio of <strong>Krishnaprasath Selvhakumar</strong>.<br>
            Collect Data Cores to uncover skills & projects.
        </p>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 2rem; text-align: left; color: #cbd5e1;">
            <div>
                <strong style="color:white">PC CONTROLS</strong><br>
                WASD: Move<br>
                MOUSE: Aim<br>
                CLICK: Auto-Fire<br>
                SPACE: Dash
            </div>
            <div>
                <strong style="color:white">TOUCH CONTROLS</strong><br>
                Left Stick: Move<br>
                Red Button: Fire<br>
                Yellow Button: Dash
            </div>
        </div>

        <button class="btn" id="start-btn">DEPLOY ROVER</button>
    </div>

    <!-- UI -->
    <div id="ui-layer" style="display: none;">
        <div class="hud-panel hud-top-left">
            <div style="display: flex; justify-content: space-between; align-items: baseline;">
                <span style="font-weight: bold; color: white;">ROVER MK-II</span>
                <span id="hp-text" style="font-size: 0.8em; color: #ef4444;">100%</span>
            </div>
            <div class="health-bar-bg"><div id="health-bar" class="health-bar-fill"></div></div>
            <div class="dash-bar-bg"><div id="dash-bar" class="dash-bar-fill"></div></div>
        </div>

        <div class="hud-panel hud-top-right">
            <span style="color: #94a3b8; font-size: 0.8em;">DATA CORES</span><br>
            <span id="score" style="font-size: 1.5rem; font-weight: bold; color: #38bdf8;">0 / 6</span>
        </div>

        <!-- Mobile Controls -->
        <div id="mobile-controls">
            <div class="joystick-area" id="joystick">
                <div class="joystick-knob" id="knob"></div>
            </div>
        </div>
        <div id="mobile-actions">
            <button id="btn-dash" class="action-btn">DASH</button>
            <button id="btn-shoot" class="action-btn">FIRE</button>
        </div>
    </div>

    <!-- Content Modal -->
    <div id="modal-overlay">
        <div class="info-card">
            <h2 id="modal-title">Title</h2>
            <div id="modal-content" class="content"></div>
            <div style="text-align: center; margin-top: 25px;">
                <button class="btn" style="padding: 10px 30px; font-size: 1rem;" onclick="game.closeModal()">RESUME</button>
            </div>
        </div>
    </div>

<script>
/** * DATA: Extracted from CV.pdf 
 */
const PORTFOLIO_DATA = [
    {
        id: 'intro', title: 'PILOT: KRISHNAPRASATH', x: 0, y: -200, color: '#f472b6',
        html: `<p><strong>Mechatronics Engineer & Game Dev</strong></p><p>Passionate about Robotics, PLCs, and Unreal Engine 5.</p><p><em>"I build systems that move."</em></p>`
    },
    {
        id: 'skills', title: 'SKILL MATRIX', x: 400, y: 0, color: '#22d3ee',
        html: `<p><strong>Engines:</strong></p><div><span class="skill-tag">Unreal Engine 5</span><span class="skill-tag">ROS 2</span><span class="skill-tag">Unity</span></div><p style="margin-top:10px"><strong>Engineering:</strong></p><div><span class="skill-tag">MATLAB</span><span class="skill-tag">AutoCAD</span><span class="skill-tag">CATIA V5</span></div><p style="margin-top:10px"><strong>Languages:</strong></p><div><span class="skill-tag">C++</span><span class="skill-tag">Python</span><span class="skill-tag">Java</span></div>`
    },
    {
        id: 'exp', title: 'FIELD EXPERIENCE', x: -400, y: 0, color: '#fb923c',
        html: `<ul><li><strong>Bheema CNC (2023):</strong> Operated VMC/CNC machines. QA & PDI for automotive parts.</li><br><li><strong>KRS Industries (2022):</strong> Maintenance Assistant. PLC Troubleshooting & Preventive Maintenance.</li></ul>`
    },
    {
        id: 'proj', title: 'PROJECTS', x: 0, y: 300, color: '#a78bfa',
        html: `<ul><li><strong>Dynamic Drill:</strong> Delta Robot manipulator design.</li><li><strong>Agri Sentry:</strong> Autonomous pest-control rover (CV-based).</li><li><strong>Face Flow:</strong> IoT Contactless Attendance System.</li></ul>`
    },
    {
        id: 'game', title: 'GAME DEV', x: 300, y: -300, color: '#34d399',
        html: `<p><strong>Indie Developer (2019-Present)</strong></p><p>Published multiple games on Play Store.</p><p>Specialized in Vehicle Dynamics & Physics simulation in Unreal Engine 5.</p>`
    },
    {
        id: 'contact', title: 'CONTACT UPLINK', x: -300, y: 300, color: '#f87171',
        html: `<p><strong>Email:</strong> Kryshn2001@gmail.com</p><p><strong>Phone:</strong> +91 6381078962</p><p><strong>Location:</strong> Chennai, India</p>`
    }
];

/**
 * GAME ENGINE
 */
class Game {
    constructor() {
        this.canvas = document.getElementById('game-layer');
        this.ctx = this.canvas.getContext('2d');
        this.resize();

        // State
        this.active = false;
        this.paused = false;
        this.lastTime = 0;
        
        // Entities
        this.player = new Player(0, 0);
        this.camera = { x: 0, y: 0 };
        this.entities = []; // Enemies, Bullets, Particles
        this.items = [];

        // Input
        this.keys = {};
        this.mouse = { x: 0, y: 0, down: false };
        this.joystick = { x: 0, y: 0, active: false };
        this.actions = { fire: false, dash: false };

        this.bindEvents();
    }

    bindEvents() {
        window.addEventListener('resize', () => this.resize());
        window.addEventListener('keydown', e => this.keys[e.code] = true);
        window.addEventListener('keyup', e => {
            this.keys[e.code] = false;
            if (e.code === 'Space') this.player.tryDash();
        });
        
        // Mouse
        window.addEventListener('mousemove', e => {
            this.mouse.x = e.clientX;
            this.mouse.y = e.clientY;
        });
        window.addEventListener('mousedown', () => this.mouse.down = true);
        window.addEventListener('mouseup', () => this.mouse.down = false);

        // Mobile Controls
        this.setupTouchControls();
    }

    setupTouchControls() {
        const joy = document.getElementById('joystick');
        const knob = document.getElementById('knob');
        let joyCenter = { x: 0, y: 0 };

        joy.addEventListener('touchstart', e => {
            e.preventDefault();
            this.joystick.active = true;
            const rect = joy.getBoundingClientRect();
            joyCenter = { x: rect.left + rect.width/2, y: rect.top + rect.height/2 };
            this.updateJoystick(e.touches[0], joyCenter, knob);
        });

        joy.addEventListener('touchmove', e => {
            e.preventDefault();
            if(this.joystick.active) this.updateJoystick(e.touches[0], joyCenter, knob);
        });

        const endJoy = e => {
            e.preventDefault();
            this.joystick.active = false;
            this.joystick.x = 0; this.joystick.y = 0;
            knob.style.transform = `translate(-50%, -50%)`;
        };
        joy.addEventListener('touchend', endJoy);

        // Buttons
        const btnFire = document.getElementById('btn-shoot');
        btnFire.addEventListener('touchstart', e => { e.preventDefault(); this.actions.fire = true; });
        btnFire.addEventListener('touchend', e => { e.preventDefault(); this.actions.fire = false; });

        const btnDash = document.getElementById('btn-dash');
        btnDash.addEventListener('touchstart', e => { e.preventDefault(); this.player.tryDash(); });
    }

    updateJoystick(touch, center, knob) {
        const dx = touch.clientX - center.x;
        const dy = touch.clientY - center.y;
        const dist = Math.min(Math.hypot(dx, dy), 35); // Max radius
        const angle = Math.atan2(dy, dx);
        
        const kx = Math.cos(angle) * dist;
        const ky = Math.sin(angle) * dist;
        
        knob.style.transform = `translate(calc(-50% + ${kx}px), calc(-50% + ${ky}px))`;
        
        // Normalize output -1 to 1
        this.joystick.x = kx / 35;
        this.joystick.y = ky / 35;
    }

    resize() {
        this.width = this.canvas.width = window.innerWidth;
        this.height = this.canvas.height = window.innerHeight;
    }

    start() {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('ui-layer').style.display = 'block';
        this.active = true;
        this.lastTime = performance.now();
        
        // Populate World
        PORTFOLIO_DATA.forEach(d => this.items.push(new DataCore(d)));
        
        // Initial Enemies
        for(let i=0; i<4; i++) this.spawnEnemy(true);

        requestAnimationFrame(t => this.loop(t));
    }

    spawnEnemy(safe = false) {
        if(this.entities.filter(e => e.type === 'enemy').length >= 10) return;

        let x, y, d;
        do {
            const a = Math.random() * 6.28;
            const r = safe ? 600 + Math.random()*200 : 800; // Spawn outside screen mostly
            x = this.player.x + Math.cos(a) * r;
            y = this.player.y + Math.sin(a) * r;
            d = Math.hypot(x - this.player.x, y - this.player.y);
        } while(d < 500);

        this.entities.push(new Enemy(x, y));
    }

    openModal(item) {
        this.paused = true;
        document.getElementById('modal-title').innerText = item.data.title;
        document.getElementById('modal-title').style.color = item.data.color;
        document.getElementById('modal-content').innerHTML = item.data.html;
        document.getElementById('modal-overlay').classList.add('active');
        
        if(!item.visited) {
            item.visited = true;
            this.player.heal(100); // Full heal on discovery
            document.getElementById('score').innerText = `${this.items.filter(i => i.visited).length} / 6`;
        }
    }

    closeModal() {
        document.getElementById('modal-overlay').classList.remove('active');
        setTimeout(() => {
            this.paused = false;
            this.lastTime = performance.now();
        }, 100);
    }

    loop(t) {
        if(!this.active) return;
        requestAnimationFrame(t => this.loop(t));
        
        if(this.paused) return;

        const dt = Math.min((t - this.lastTime) / 1000, 0.1);
        this.lastTime = t;

        this.update(dt);
        this.draw();
    }

    update(dt) {
        // Player
        this.player.update(dt, this);

        // Camera (Smooth Lerp)
        this.camera.x += (this.player.x - this.width/2 - this.camera.x) * 5 * dt;
        this.camera.y += (this.player.y - this.height/2 - this.camera.y) * 5 * dt;

        // Entities
        this.entities.forEach(e => e.update(dt, this));
        this.entities = this.entities.filter(e => !e.dead);

        // Enemy Spawner
        if(Math.random() < 0.01) this.spawnEnemy();

        // Collisions
        // 1. Bullets vs Enemies
        this.entities.filter(e => e.type === 'bullet').forEach(b => {
            this.entities.filter(e => e.type === 'enemy').forEach(en => {
                if(Math.hypot(b.x - en.x, b.y - en.y) < en.radius + b.radius) {
                    en.hit(1, this);
                    b.dead = true;
                }
            });
        });

        // 2. Player vs Items
        this.items.forEach(item => {
            if(Math.hypot(this.player.x - item.x, this.player.y - item.y) < this.player.radius + item.radius) {
                this.openModal(item);
                // Push player slightly
                const a = Math.atan2(this.player.y - item.y, this.player.x - item.x);
                this.player.x += Math.cos(a) * 10;
                this.player.y += Math.sin(a) * 10;
            }
        });

        // 3. Player vs Enemies
        this.entities.filter(e => e.type === 'enemy').forEach(en => {
            if(Math.hypot(this.player.x - en.x, this.player.y - en.y) < this.player.radius + en.radius) {
                this.player.hit(10);
                en.hit(10, this); // Enemy takes impact damage
                // Knockback
                const a = Math.atan2(this.player.y - en.y, this.player.x - en.x);
                this.player.vx += Math.cos(a) * 500;
                this.player.vy += Math.sin(a) * 500;
            }
        });
    }

    draw() {
        this.ctx.fillStyle = '#0b1120';
        this.ctx.fillRect(0, 0, this.width, this.height);

        this.ctx.save();
        this.ctx.translate(-this.camera.x, -this.camera.y);

        // Grid (Subtle)
        this.ctx.strokeStyle = '#1e293b';
        this.ctx.lineWidth = 2;
        const s = 100;
        const sx = Math.floor(this.camera.x / s) * s;
        const sy = Math.floor(this.camera.y / s) * s;
        this.ctx.beginPath();
        for(let x = sx; x < sx + this.width + s; x+=s) { this.ctx.moveTo(x, sy); this.ctx.lineTo(x, sy + this.height + s); }
        for(let y = sy; y < sy + this.height + s; y+=s) { this.ctx.moveTo(sx, y); this.ctx.lineTo(sx + this.width + s, y); }
        this.ctx.stroke();

        // Connectors
        this.ctx.strokeStyle = '#334155';
        this.ctx.lineWidth = 4;
        this.ctx.lineCap = 'round';
        this.ctx.beginPath();
        this.items.forEach(i => { this.ctx.moveTo(0,0); this.ctx.lineTo(i.x, i.y); });
        this.ctx.stroke();

        // Items
        this.items.forEach(i => i.draw(this.ctx));
        
        // Entities
        this.entities.forEach(e => e.draw(this.ctx));
        
        // Player
        this.player.draw(this.ctx, this);

        this.ctx.restore();
    }
}

/**
 * ENTITIES
 */
class Player {
    constructor(x, y) {
        this.x = x; this.y = y;
        this.vx = 0; this.vy = 0;
        this.radius = 25;
        this.angle = 0; // Movement direction
        this.aimAngle = 0; // Turret direction
        this.health = 100;
        this.maxHealth = 100;
        
        this.lastShot = 0;
        this.fireRate = 0.1; // Fast fire rate
        
        this.dashCooldown = 0;
        this.dashMax = 2; // seconds
        this.regenTimer = 0;
    }

    update(dt, game) {
        // Movement Input
        let dx = 0, dy = 0;
        if(game.keys['KeyW'] || game.keys['ArrowUp']) dy = -1;
        if(game.keys['KeyS'] || game.keys['ArrowDown']) dy = 1;
        if(game.keys['KeyA'] || game.keys['ArrowLeft']) dx = -1;
        if(game.keys['KeyD'] || game.keys['ArrowRight']) dx = 1;

        if(game.joystick.active) {
            dx = game.joystick.x;
            dy = game.joystick.y;
        }

        // Physics
        const speed = 400;
        const friction = 0.9;
        
        if(dx || dy) {
            this.vx += dx * speed * dt * 8; // Snappy acceleration
            this.vy += dy * speed * dt * 8;
            this.angle = Math.atan2(dy, dx);
        }

        this.vx *= friction;
        this.vy *= friction;
        this.x += this.vx * dt;
        this.y += this.vy * dt;

        // Turret Aim
        if(game.joystick.active && (game.actions.fire)) {
            // On mobile, if firing, aim where moving or maybe auto aim?
            // Let's make mobile auto-aim nearest enemy if not careful
            // For now, keep mobile aim same as move dir
            this.aimAngle = this.angle;
        } else {
            const mx = game.mouse.x + game.camera.x;
            const my = game.mouse.y + game.camera.y;
            this.aimAngle = Math.atan2(my - this.y, mx - this.x);
        }

        // Shooting
        if((game.mouse.down || game.actions.fire)) {
            const now = performance.now()/1000;
            if(now - this.lastShot > this.fireRate) {
                game.entities.push(new Bullet(this.x, this.y, this.aimAngle));
                this.lastShot = now;
                // Kickback
                this.vx -= Math.cos(this.aimAngle) * 50;
                this.vy -= Math.sin(this.aimAngle) * 50;
            }
        }

        // Dash Cooldown
        if(this.dashCooldown > 0) this.dashCooldown -= dt;
        document.getElementById('dash-bar').style.width = `${Math.max(0, 1 - (this.dashCooldown/this.dashMax))*100}%`;

        // Health Regen
        if(this.regenTimer > 0) this.regenTimer -= dt;
        else if(this.health < 100) this.health += 10 * dt; // Regen 10hp/s
        this.updateHealthUI();
    }

    tryDash() {
        if(this.dashCooldown <= 0) {
            const dashForce = 1200;
            // Dash in movement direction, or aim direction if standing still
            let dir = (Math.abs(this.vx) > 10 || Math.abs(this.vy) > 10) ? Math.atan2(this.vy, this.vx) : this.aimAngle;
            
            this.vx += Math.cos(dir) * dashForce;
            this.vy += Math.sin(dir) * dashForce;
            this.dashCooldown = this.dashMax;
            
            // FX
            // game.entities.push(...)
        }
    }

    hit(dmg) {
        this.health -= dmg;
        this.regenTimer = 3; // No regen for 3 secs
        this.updateHealthUI();
        if(this.health <= 0) {
            this.health = 100;
            this.x = 0; this.y = 0; // Respawn center
            alert("SYSTEM CRITICAL. RESPAWNING...");
        }
    }

    heal(amt) {
        this.health = Math.min(this.maxHealth, this.health + amt);
        this.updateHealthUI();
    }

    updateHealthUI() {
        document.getElementById('health-bar').style.width = `${this.health}%`;
        document.getElementById('hp-text').innerText = `${Math.floor(this.health)}%`;
    }

    draw(ctx) {
        ctx.save();
        ctx.translate(this.x, this.y);

        // Body (Rotates with movement)
        ctx.save();
        ctx.rotate(this.angle);
        ctx.fillStyle = '#1e293b';
        ctx.strokeStyle = '#38bdf8';
        ctx.lineWidth = 2;
        // Chassis
        ctx.fillRect(-20, -15, 40, 30);
        ctx.strokeRect(-20, -15, 40, 30);
        // Wheels
        ctx.fillStyle = '#64748b';
        ctx.fillRect(-22, -20, 12, 8); ctx.fillRect(10, -20, 12, 8);
        ctx.fillRect(-22, 12, 12, 8); ctx.fillRect(10, 12, 12, 8);
        ctx.restore();

        // Turret (Rotates with aim)
        ctx.save();
        ctx.rotate(this.aimAngle);
        ctx.fillStyle = '#0ea5e9';
        ctx.beginPath(); ctx.arc(0, 0, 12, 0, 6.28); ctx.fill();
        ctx.fillStyle = '#0284c7';
        ctx.fillRect(0, -4, 28, 8); // Barrel
        ctx.restore();

        ctx.restore();
    }
}

class Bullet {
    constructor(x, y, angle) {
        this.type = 'bullet';
        this.x = x; this.y = y;
        const speed = 1000;
        this.vx = Math.cos(angle) * speed;
        this.vy = Math.sin(angle) * speed;
        this.life = 0.8;
        this.radius = 5;
        this.dead = false;
    }
    update(dt) {
        this.x += this.vx * dt;
        this.y += this.vy * dt;
        this.life -= dt;
        if(this.life <= 0) this.dead = true;
    }
    draw(ctx) {
        ctx.fillStyle = '#facc15';
        ctx.beginPath(); ctx.arc(this.x, this.y, 4, 0, 6.28); ctx.fill();
        ctx.shadowBlur = 10; ctx.shadowColor = '#facc15'; ctx.fill(); ctx.shadowBlur = 0;
    }
}

class Enemy {
    constructor(x, y) {
        this.type = 'enemy';
        this.x = x; this.y = y;
        this.hp = 3;
        this.speed = 150; // Slower than player
        this.radius = 20;
        this.dead = false;
        this.color = '#ef4444';
    }
    update(dt, game) {
        const dx = game.player.x - this.x;
        const dy = game.player.y - this.y;
        const dist = Math.hypot(dx, dy);
        
        if(dist > 0) {
            this.x += (dx/dist) * this.speed * dt;
            this.y += (dy/dist) * this.speed * dt;
        }
    }
    hit(dmg, game) {
        this.hp -= dmg;
        if(this.hp <= 0) {
            this.dead = true;
            // Explosion
            for(let i=0; i<6; i++) game.entities.push(new Particle(this.x, this.y, this.color));
        }
    }
    draw(ctx) {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(Math.sin(performance.now()/200)*0.2); // Idle wobble
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.moveTo(15, 0); ctx.lineTo(-10, 10); ctx.lineTo(-10, -10);
        ctx.fill();
        ctx.restore();
    }
}

class Particle {
    constructor(x, y, c) {
        this.type = 'particle';
        this.x = x; this.y = y;
        const a = Math.random()*6.28;
        const s = Math.random()*150;
        this.vx = Math.cos(a)*s;
        this.vy = Math.sin(a)*s;
        this.life = 0.5;
        this.color = c;
    }
    update(dt) {
        this.x += this.vx * dt;
        this.y += this.vy * dt;
        this.life -= dt;
        if(this.life <= 0) this.dead = true;
    }
    draw(ctx) {
        ctx.globalAlpha = this.life * 2;
        ctx.fillStyle = this.color;
        ctx.beginPath(); ctx.arc(this.x, this.y, 3, 0, 6.28); ctx.fill();
        ctx.globalAlpha = 1;
    }
}

class DataCore {
    constructor(d) {
        this.data = d;
        this.x = d.x; this.y = d.y;
        this.radius = 35;
        this.visited = false;
        this.t = Math.random()*10;
    }
    draw(ctx) {
        this.t += 0.05;
        const yOffset = Math.sin(this.t) * 5;
        
        ctx.save();
        ctx.translate(this.x, this.y + yOffset);
        
        // Glow
        const g = ctx.createRadialGradient(0,0, 10, 0,0, 60);
        g.addColorStop(0, this.visited ? '#475569' : this.data.color);
        g.addColorStop(1, 'rgba(0,0,0,0)');
        ctx.fillStyle = g;
        ctx.fillRect(-60, -60, 120, 120);

        // Icon
        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 2;
        ctx.strokeRect(-20, -20, 40, 40);
        
        ctx.fillStyle = '#fff';
        ctx.font = 'bold 12px "Share Tech Mono"';
        ctx.textAlign = 'center';
        ctx.fillText(this.data.id.toUpperCase(), 0, 35);
        
        ctx.restore();
    }
}

// Init
const game = new Game();
document.getElementById('start-btn').addEventListener('click', () => game.start());

</script>
</body>
</html>

